<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>N√∫cleo Insight | An√°lise</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #0f0c29; color: #e2e8f0; -webkit-tap-highlight-color: transparent; }
        
        /* VISUAL M√çSTICO PREMIUM */
        .bg-gradient-mystic { background: linear-gradient(to bottom, #0f0c29, #302b63, #24243e); }
        .glass-card { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(16px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); }
        
        .blur-secret { filter: blur(10px); user-select: none; pointer-events: none; }
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.22, 1, 0.36, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .modal-open { display: flex !important; }
        
        /* Menu Fixo */
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: rgba(15, 12, 41, 0.95); backdrop-filter: blur(12px); border-top: 1px solid rgba(255,255,255,0.05); padding: 12px 0; display: flex; justify-content: space-around; z-index: 50; padding-bottom: max(12px, env(safe-area-inset-bottom)); }
        
        /* CORRE√á√ÉO DO CSS: Garante que itens ocultos fiquem ocultos */
        .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: #64748b; gap: 5px; width: 33%; transition: all 0.3s; }
        .nav-item.hidden { display: none !important; } 
        
        .nav-item.active { color: #c084fc; transform: translateY(-2px); }
        .nav-item.active svg { stroke: #c084fc; filter: drop-shadow(0 0 8px rgba(192, 132, 252, 0.6)); }
        
        /* UI Elements */
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.4s; }
        .phase-card { background: rgba(0,0,0,0.2); border: 1px solid rgba(192, 132, 252, 0.15); border-radius: 16px; padding: 16px; margin-bottom: 16px; }
        .phase-title { color: #e879f9; font-weight: 800; font-size: 0.8rem; text-transform: uppercase; margin-bottom: 10px; letter-spacing: 0.05em; }
        .day-badge { background: #4c1d95; color: #e9d5ff; padding: 3px 10px; border-radius: 20px; font-size: 0.65rem; font-weight: 700; display: inline-block; margin-bottom: 6px; }
        
        .pulse-soft { animation: pulse-soft 3s infinite; }
        @keyframes pulse-soft { 0% { box-shadow: 0 0 0 0 rgba(192, 132, 252, 0.4); } 70% { box-shadow: 0 0 0 15px rgba(192, 132, 252, 0); } 100% { box-shadow: 0 0 0 0 rgba(192, 132, 252, 0); } }
        
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-gradient-mystic pb-24 text-slate-200 font-sans selection:bg-purple-500 selection:text-white">

    <div id="quiz-flow" class="p-4 flex flex-col items-center justify-center min-h-screen">
        <div id="quiz-container" class="w-full max-w-md glass-card p-6 rounded-3xl shadow-2xl fade-in relative overflow-hidden">
            <div class="absolute top-[-50%] left-[-50%] w-[200%] h-[200%] bg-[radial-gradient(circle,rgba(139,92,246,0.1)_0%,transparent_50%)] pointer-events-none"></div>
            
            <div class="mb-8 flex items-center justify-between relative z-10">
                <span class="text-[10px] font-bold tracking-[0.2em] text-purple-300 uppercase">An√°lise Neural</span>
                <div class="h-1 w-24 bg-white/5 rounded-full overflow-hidden"><div id="progress-bar" class="h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-500" style="width: 10%"></div></div>
            </div>
            
            <h2 id="question-text" class="text-xl md:text-2xl font-bold mb-8 text-white leading-snug min-h-[90px] relative z-10">...</h2>
            <div id="answers-box" class="space-y-3 relative z-10"></div>
        </div>

        <div id="processing-container" class="hidden w-full max-w-md text-center fade-in">
            <div class="relative w-24 h-24 mx-auto mb-8">
                <div class="absolute inset-0 rounded-full border-4 border-white/5"></div>
                <div class="absolute inset-0 rounded-full border-4 border-t-purple-500 border-r-transparent border-b-purple-500 border-l-transparent animate-spin"></div>
                <div class="absolute inset-0 flex items-center justify-center font-bold text-purple-300 text-sm animate-pulse" id="process-pct">0%</div>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">Processando Micro-express√µes...</h3>
            <p id="process-text" class="text-sm text-slate-400">Comparando com 12.000 padr√µes comportamentais...</p>
        </div>

        <div id="auth-container" class="hidden w-full max-w-md glass-card p-8 rounded-3xl text-center fade-in border-t border-purple-500/20">
            <div class="w-16 h-16 bg-gradient-to-tr from-purple-600 to-pink-600 rounded-full flex items-center justify-center mx-auto mb-6 pulse-soft shadow-lg shadow-purple-500/30">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
            </div>
            <h2 class="text-2xl font-bold text-white mb-3">Ciclo de Risco Detectado</h2>
            <p class="text-slate-300 mb-8 text-sm leading-relaxed">Identificamos um padr√£o grave de **Autossabotagem Inconsciente**. Para sua seguran√ßa, o relat√≥rio completo √© protegido.</p>
            <button onclick="loginGoogle()" class="w-full bg-white hover:bg-slate-50 text-slate-900 font-bold py-4 px-6 rounded-xl flex items-center justify-center gap-3 shadow-xl transition transform hover:scale-[1.02]">
                <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5" alt="G"> Liberar Meu Diagn√≥stico
            </button>
            <div class="flex items-center justify-center gap-2 mt-6 opacity-60">
                <svg class="w-3 h-3 text-emerald-400" fill="currentColor" viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/></svg>
                <p class="text-[10px] text-slate-400 uppercase tracking-widest">Ambiente Criptografado</p>
            </div>
        </div>
    </div>

    <div id="app-container" class="hidden w-full max-w-md mx-auto fade-in p-4 pt-6">
        
        <div class="flex items-center justify-between mb-8">
            <div class="flex items-center gap-2 px-3 py-1 bg-white/5 rounded-full border border-white/5">
                <span class="relative flex h-2 w-2">
                  <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                  <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                </span>
                <span class="text-[9px] font-bold tracking-widest text-emerald-300">ONLINE</span>
            </div>
            <button onclick="logout()" class="text-xs text-slate-400 hover:text-white underline decoration-slate-600 underline-offset-4">Sair</button>
        </div>

        <div id="tab-home" class="tab-content active">
            <div class="glass-card rounded-3xl overflow-hidden shadow-2xl relative mb-6 border-t border-purple-500/20">
                <div class="bg-black/30 p-5 border-b border-white/5 flex justify-between items-center backdrop-blur-md">
                    <h3 class="font-bold text-white">Seu Diagn√≥stico</h3>
                    <span class="bg-red-500/10 text-red-400 text-[10px] font-extrabold px-3 py-1 rounded-full border border-red-500/20 tracking-wider">CR√çTICO</span>
                </div>
                
                <div class="p-6 relative">
                    <h2 class="text-2xl font-bold text-white mb-4 leading-tight">Arqu√©tipo: <span class="text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400">Disponibilidade Assim√©trica</span></h2>
                    
                    <div id="premium-content" class="text-slate-300 space-y-5 blur-secret transition-all duration-700 text-sm leading-relaxed">
                        <p><strong class="text-white">A Verdade Brutal:</strong> Voc√™ est√° ensinando a ele que o seu tempo n√£o vale nada.</p>
                        <p>Nossos dados mostram que em 90% das intera√ß√µes, voc√™ respondeu em menos de 5 minutos. Isso criou um desequil√≠brio qu√≠mico no c√©rebro dele: <span class="text-purple-300 font-semibold">falta de dopamina por esfor√ßo.</span></p>
                        <div class="bg-purple-900/20 p-4 rounded-xl border-l-4 border-purple-500 my-2">
                            <p class="text-purple-400 font-bold text-[10px] mb-1 uppercase tracking-wider">Previs√£o do Algoritmo:</p>
                            <p class="italic text-slate-200">"Se voc√™ mandar mais uma mensagem cobrando aten√ß√£o hoje, as chances de bloqueio definitivo sobem para 94%."</p>
                        </div>
                        <p>Para reverter isso, voc√™ precisa aplicar o <strong>Plano de Resgate de 30 Dias</strong> (Dispon√≠vel na aba Protocolo).</p>
                    </div>
                    
                    <div id="paywall-overlay" class="absolute inset-0 bg-[#0f0c29]/95 backdrop-blur-[4px] flex flex-col items-center justify-center p-6 text-center z-10 rounded-b-3xl">
                        <div class="w-14 h-14 bg-gradient-to-br from-slate-700 to-slate-800 rounded-full flex items-center justify-center mb-4 border border-white/10 shadow-lg">
                            <svg class="w-6 h-6 text-slate-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                        </div>
                        <h3 class="text-xl font-bold text-white mb-2">Risco de Afastamento Permanente</h3>
                        <p class="text-sm text-slate-400 mb-6 leading-relaxed">Seus padr√µes atuais ativaram um "Gatilho de Repuls√£o".<br>O Simulador j√° gerou a mensagem de corre√ß√£o. Destrave antes que ele visualize e te ignore.</p>
                        <a id="buy-btn-diag" href="https://pay.kiwify.com.br/cAMh7az" target="_blank" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 text-white font-bold py-4 px-4 rounded-xl shadow-[0_0_25px_rgba(192,132,252,0.3)] mb-4 flex items-center justify-center gap-2 transition transform active:scale-[0.98] group">
                            <span>Destravar Meu Diagn√≥stico</span>
                            <svg class="w-4 h-4 group-hover:translate-x-1 transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
                        </a>
                        <p class="text-[10px] text-slate-500">R$ 27,00 ‚Ä¢ Acesso Imediato</p>
                        <button onclick="simularCompraDev()" class="admin-only hidden mt-4 text-[9px] text-slate-600 border border-slate-800 px-3 py-1 rounded hover:text-white hover:border-white uppercase tracking-widest">[ADMIN: Desbloquear R$27]</button>
                    </div>
                </div>
            </div>
            
            <div class="glass-card p-4 rounded-xl text-center mb-20 border-white/5">
                <p class="text-xs text-slate-400 mb-3">N√£o perca o acesso √† sua an√°lise:</p>
                <button onclick="openSaveModal()" class="text-xs bg-white/5 hover:bg-white/10 text-white px-4 py-2.5 rounded-lg flex items-center justify-center gap-2 mx-auto transition border border-white/5">
                    <svg class="w-4 h-4 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg> Salvar App no Celular
                </button>
            </div>
        </div>

        <div id="tab-simulador" class="tab-content">
            <h2 class="text-2xl font-bold text-white mb-2">Simulador Neural</h2>
            <p class="text-sm text-slate-400 mb-6">Qual a situa√ß√£o exata agora? O sistema vai gerar a resposta perfeita.</p>
            <div class="space-y-4">
                <button onclick="showScript('ghosting')" class="w-full text-left glass-card hover:bg-white/10 p-5 rounded-2xl transition group relative overflow-hidden">
                    <div class="absolute left-0 top-0 bottom-0 w-1 bg-purple-500 opacity-50 group-hover:opacity-100 transition"></div>
                    <span class="block text-white font-bold text-sm mb-1">üëª Ele sumiu (Ghosting)</span>
                    <span class="text-xs text-slate-400 group-hover:text-slate-200">N√£o responde h√° mais de 24h</span>
                </button>
                <button onclick="showScript('cold')" class="w-full text-left glass-card hover:bg-white/10 p-5 rounded-2xl transition group relative overflow-hidden">
                    <div class="absolute left-0 top-0 bottom-0 w-1 bg-blue-500 opacity-50 group-hover:opacity-100 transition"></div>
                    <span class="block text-white font-bold text-sm mb-1">‚ùÑÔ∏è Ele est√° frio/seco</span>
                    <span class="text-xs text-slate-400 group-hover:text-slate-200">Responde monos√≠labos ou demora</span>
                </button>
                <button onclick="showScript('invite')" class="w-full text-left glass-card hover:bg-white/10 p-5 rounded-2xl transition group relative overflow-hidden">
                    <div class="absolute left-0 top-0 bottom-0 w-1 bg-red-500 opacity-50 group-hover:opacity-100 transition"></div>
                    <span class="block text-white font-bold text-sm mb-1">üìÖ Cancelou o encontro</span>
                    <span class="text-xs text-slate-400 group-hover:text-slate-200">Deu uma desculpa esfarrapada</span>
                </button>
            </div>
            <div id="script-result" class="hidden mt-8 bg-gradient-to-b from-slate-800 to-slate-900 border border-purple-500/30 p-6 rounded-2xl animate-[fadeIn_0.5s] relative shadow-2xl">
                <div class="absolute -top-3 left-6 bg-purple-600 text-white text-[10px] font-bold px-2 py-1 rounded shadow-lg">RESPOSTA GERADA</div>
                <p id="script-text" class="text-white text-base font-medium leading-relaxed select-all">...</p>
                <div class="mt-4 pt-4 border-t border-white/5 flex justify-between items-center">
                    <span class="text-[10px] text-slate-500">Probabilidade de Resposta: <span class="text-emerald-400 font-bold">89%</span></span>
                    <span class="text-[10px] text-slate-500 uppercase tracking-wider">N√£o use emojis</span>
                </div>
            </div>
        </div>

        <div id="tab-protocolo" class="tab-content relative min-h-[60vh]">
            <h2 class="text-2xl font-bold text-white mb-2">Plano de Resgate</h2>
            <p class="text-sm text-slate-400 mb-6">O cronograma exato de 30 dias para reverter a rejei√ß√£o.</p>
            
            <div id="protocol-content" class="blur-secret transition-all duration-700 pb-24">
                <div class="phase-card">
                    <div class="phase-title"><span class="text-lg mr-2">üö´</span> Fase 1: Interrup√ß√£o (Dias 1-7)</div>
                    <div class="space-y-3">
                        <div class="bg-white/5 p-3 rounded-lg border border-white/5">
                            <span class="day-badge">Dia 1-2</span>
                            <p class="text-xs text-slate-300 leading-relaxed">Sil√™ncio Absoluto. O c√©rebro dele s√≥ nota sua aus√™ncia quando a presen√ßa era excessiva.</p>
                        </div>
                        <div class="bg-white/5 p-3 rounded-lg border border-white/5">
                            <span class="day-badge">Dia 3-4</span>
                            <p class="text-xs text-slate-300 leading-relaxed">Neutraliza√ß√£o. Se ele falar: Responda educado, curto e sem perguntas.</p>
                        </div>
                    </div>
                </div>
                <div class="phase-card">
                    <div class="phase-title"><span class="text-lg mr-2">‚ú®</span> Fase 2: Reposicionamento (8-15)</div>
                    <div class="bg-white/5 p-3 rounded-lg border border-white/5">
                        <span class="day-badge">Dia 8-10</span>
                        <p class="text-xs text-slate-300 leading-relaxed">Micro-presen√ßa: 1 rea√ß√£o leve a story. Sem texto emocional. Mostre que voc√™ est√° viva, mas n√£o dispon√≠vel.</p>
                    </div>
                </div>
                <div class="phase-card">
                    <div class="phase-title"><span class="text-lg mr-2">üé£</span> Fase 3: A Isca (16-23)</div>
                    <div class="bg-white/5 p-3 rounded-lg border border-white/5">
                        <span class="day-badge">Estrat√©gia</span>
                        <p class="text-xs text-slate-300 leading-relaxed">Convite Indireto: "Vou fazer X tal dia. Se animar, aparece." Sem cobran√ßa.</p>
                    </div>
                </div>
            </div>

            <div id="protocol-lock" class="absolute inset-0 z-10 flex flex-col items-center justify-center p-6 text-center bg-[#0f0c29]/95 backdrop-blur-[6px] rounded-xl mt-12 border border-white/5">
                <div class="w-16 h-16 bg-gradient-to-br from-purple-600 to-blue-600 rounded-full flex items-center justify-center mb-5 shadow-[0_0_30px_rgba(147,51,234,0.3)] pulse-soft">
                    <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                </div>
                <h3 class="text-2xl font-bold text-white mb-3">Acesso Bloqueado</h3>
                <p class="text-sm text-slate-400 mb-8 leading-relaxed max-w-[280px]">Saber o problema n√£o basta. Voc√™ precisa do <strong>Mapa de 30 Dias</strong> para obrigar o c√©rebro dele a sentir sua falta.</p>
                <a href="https://pay.kiwify.com.br/7B4m9iI" target="_blank" class="w-full bg-white text-purple-900 font-bold py-4 px-4 rounded-xl shadow-xl mb-4 flex items-center justify-center gap-2 transition transform hover:scale-[1.02] border-b-4 border-slate-200 active:border-b-0 active:translate-y-1">
                    <span>Liberar Plano de Resgate</span>
                    <span class="bg-purple-100 text-purple-900 text-[10px] px-2 py-0.5 rounded font-extrabold border border-purple-200">R$ 47</span>
                </a>
                <p class="text-[10px] text-slate-500 uppercase tracking-widest">Conte√∫do desbloqueado na tela</p>
                <button onclick="simularCompraProtocoloDev()" class="admin-only hidden mt-8 text-[9px] text-slate-600 border border-slate-800 px-3 py-1 rounded hover:text-white hover:border-white uppercase tracking-widest">[ADMIN: Liberar R$47]</button>
            </div>
        </div>

    </div>

    <div id="bottom-nav" class="hidden bottom-nav">
        <button onclick="switchTab('home')" class="nav-item active" id="nav-home">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
            <span>An√°lise</span>
        </button>
        <button onclick="switchTab('simulador')" class="nav-item" id="nav-simulador">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/></svg>
            <span>Simulador</span>
        </button>
        <button onclick="switchTab('protocolo')" class="nav-item relative hidden" id="nav-protocolo">
            <div class="absolute top-0 right-8 w-2.5 h-2.5 bg-red-500 rounded-full border border-[#1e293b] animate-bounce shadow-lg shadow-red-500/50"></div>
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"/></svg>
            <span>Protocolo</span>
        </button>
    </div>

    <div id="save-modal" class="hidden fixed inset-0 z-50 bg-black/90 backdrop-blur-sm items-end sm:items-center justify-center p-0 sm:p-4">
        <div class="glass-card w-full max-w-md rounded-t-3xl sm:rounded-3xl border-t sm:border border-white/10 shadow-2xl p-6 text-center">
            <h3 class="text-lg font-bold text-white mb-2">Salve seu Acesso</h3>
            <p class="text-sm text-slate-400 mb-6">Envie o link para seu pr√≥prio WhatsApp para n√£o perder.</p>
            <button onclick="shareToWhatsapp()" class="w-full bg-[#25D366] hover:bg-[#20bd5a] text-white font-bold py-3.5 px-4 rounded-xl mb-3 flex items-center justify-center gap-2 transition">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372s-1.04 1.016-1.04 2.479 1.065 2.876 1.213 3.074c.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"/></svg>
                Salvar no WhatsApp
            </button>
            <button onclick="closeSaveModal()" class="w-full bg-white/5 hover:bg-white/10 text-white py-3 rounded-xl transition">Fechar</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCFnz5Wis_b3CGGblNn-bfUjqEgTOlqGNE",
            authDomain: "nucleoinsight-e4566.firebaseapp.com",
            projectId: "nucleoinsight-e4566",
            storageBucket: "nucleoinsight-e4566.firebasestorage.app",
            messagingSenderId: "650150743348",
            appId: "1:650150743348:web:f62f3cc95a38a5e90ca961",
            measurementId: "G-M24P3TBP5J"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();
        
        // üö® SEUS EMAILS ADMIN
        const adminEmails = ["contatogilvannborges@gmail.com", "gilvanxavierborges@gmail.com"];
        
        let userStatus = 'free'; 

        // --- SISTEMA DE ABAS ---
        window.switchTab = (tabName) => {
            // Seguran√ßa Simulador
            if (tabName === 'simulador' && userStatus === 'free') {
                const btn = document.getElementById('buy-btn-diag');
                btn.scrollIntoView({behavior: "smooth", block: "center"});
                btn.classList.add('shake'); setTimeout(()=>btn.classList.remove('shake'), 500);
                return;
            }
            
            // Troca Visual
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.getElementById(`tab-${tabName}`).classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(`nav-${tabName}`).classList.add('active');
            
            window.scrollTo(0,0);
        };

        // --- AUTH & LOGIC ---
        window.loginGoogle = async () => {
            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                await setDoc(doc(db, "users", user.email), { email: user.email, lastLogin: new Date() }, { merge: true });
            } catch (error) { console.error(error); }
        };

        window.logout = () => { signOut(auth).then(() => window.location.reload()); };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('quiz-flow').classList.add('hidden');
                document.getElementById('app-container').classList.remove('hidden');
                document.getElementById('bottom-nav').classList.remove('hidden');

                if(adminEmails.includes(user.email)) {
                    document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('hidden'));
                }

                onSnapshot(doc(db, "users", user.email), (doc) => {
                    const data = doc.data();
                    
                    // N√çVEL 1: DIAGN√ìSTICO (R$ 27)
                    if (data && data.status === "premium") {
                        userStatus = 'premium';
                        document.getElementById('premium-content').classList.remove('blur-secret');
                        document.getElementById('paywall-overlay').classList.add('hidden');
                        
                        // ‚ú® AQUI EST√Å A M√ÅGICA: Revela a aba Protocolo
                        document.getElementById('nav-protocolo').classList.remove('hidden'); 
                    }

                    // N√çVEL 2: PROTOCOLO (R$ 47)
                    if (data && data.protocol === "active") {
                        userStatus = 'vip';
                        document.getElementById('premium-content').classList.remove('blur-secret');
                        document.getElementById('paywall-overlay').classList.add('hidden');
                        document.getElementById('nav-protocolo').classList.remove('hidden'); 
                        
                        document.getElementById('protocol-content').classList.remove('blur-secret');
                        document.getElementById('protocol-lock').classList.add('hidden');
                    }
                });
            }
        });

        // --- SIMULADORES ADMIN (COM REFRESH AUTOM√ÅTICO) ---
        window.simularCompraDev = async () => {
            const user = auth.currentUser;
            if(user) {
                await setDoc(doc(db, "users", user.email), { status: "premium" }, { merge: true });
                alert("üëë Admin: Diagn√≥stico desbloqueado!");
                window.location.reload(); 
            }
        };
        
        window.simularCompraProtocoloDev = async () => {
            const user = auth.currentUser;
            if(user) {
                await setDoc(doc(db, "users", user.email), { protocol: "active", status: "premium" }, { merge: true });
                alert("üëë Admin: Protocolo desbloqueado!");
                window.location.reload();
            }
        };

        // --- UI UTILS ---
        window.openSaveModal = () => document.getElementById('save-modal').classList.add('modal-open');
        window.closeSaveModal = () => document.getElementById('save-modal').classList.remove('modal-open');
        window.shareToWhatsapp = () => { window.open(`https://wa.me/?text=Meu%20acesso:%20${window.location.href}`, '_blank'); };
        
        window.showScript = (type) => {
            const msgs = {
                ghosting: "Vi algo hoje que me lembrou muito voc√™. Espero que esteja tudo bem por a√≠.",
                cold: "Parece que voc√™ est√° num dia corrido. A gente se fala quando estiver mais tranquilo.",
                invite: "Tranquilo. Aproveite seu dia."
            };
            document.getElementById('script-result').classList.remove('hidden');
            document.getElementById('script-text').innerText = msgs[type];
        };

        // --- QUIZ LOGIC ---
        const realQuestions = [
            { t: "Quando voc√™ envia uma mensagem e ele demora, qual seu primeiro pensamento?", a: ["'Ele perdeu o interesse.'", "'Talvez esteja ocupado.'", "'Vou apagar antes que ele leia.'", "'Melhor mandar outra pra garantir.'"] },
            { t: "Nos √∫ltimos 3 meses, quem iniciou a maioria das conversas?", a: ["Eu (quase sempre)", "Ele (quase sempre)", "Equilibrado", "Ele inicia, mas some depois"] },
            { t: "Se ele postar um story agora, quanto tempo voc√™ leva para ver?", a: ["Imediatamente (tenho notifica√ß√£o)", "Em alguns minutos", "S√≥ quando abro o app", "Evito ver pra n√£o dar moral"] },
            { t: "Voc√™ sente que precisa 'pisar em ovos' para n√£o irrit√°-lo?", a: ["Sim, tenho medo de falar errado", "√Äs vezes", "N√£o, sou espont√¢nea", "Sinto que ele que pisa em ovos"] },
            { t: "Como foi o fim (ou afastamento) da √∫ltima vez?", a: ["Do nada (Ghosting)", "Briga explosiva", "Esfriou aos poucos", "Ainda estamos nos falando, mas mal"] },
            { t: "O quanto voc√™ sabe da rotina dele?", a: ["Sei tudo (stalkei/pergunto)", "Sei o b√°sico", "Sei s√≥ o que ele conta", "N√£o sei quase nada"] },
            { t: "Quando voc√™s saem, a qu√≠mica √©...", a: ["Incr√≠vel, parece alma g√™mea", "Boa, mas ele √© fechado", "Normal", "Sinto ele distante pessoalmente"] },
            { t: "Voc√™ j√° deixou de fazer algo seu para ficar dispon√≠vel pra ele?", a: ["V√°rias vezes", "Raramente", "Nunca", "Sim, cancelei compromissos"] },
            { t: "Ele j√° disse que voc√™ √© 'intensa demais' ou 'dram√°tica'?", a: ["Sim, j√° ouvi isso", "Disse que sou fechada", "Nunca disse", "Disse que sou a mulher da vida dele"] },
            { t: "O que voc√™ MAIS quer agora?", a: ["Entender por que ele mudou", "Fazer ele correr atr√°s", "Ter paz de esp√≠rito", "Uma resposta definitiva"] }
        ];
        
        const qText = document.getElementById('question-text');
        const aBox = document.getElementById('answers-box');
        
        function runQuiz(idx) {
            const pct = ((idx) / realQuestions.length) * 100;
            document.getElementById('progress-bar').style.width = `${pct}%`;

            if(idx >= realQuestions.length) {
                document.getElementById('quiz-container').classList.add('hidden');
                document.getElementById('processing-container').classList.remove('hidden');
                
                let p = 0;
                const int = setInterval(() => {
                    p += Math.floor(Math.random() * 15);
                    if(p > 100) p = 100;
                    document.getElementById('process-pct').innerText = p + '%';
                    if(p === 100) {
                        clearInterval(int);
                        setTimeout(() => {
                            document.getElementById('processing-container').classList.add('hidden');
                            document.getElementById('auth-container').classList.remove('hidden');
                        }, 800);
                    }
                }, 300);
                return;
            }
            
            qText.innerText = realQuestions[idx].t;
            aBox.innerHTML = '';
            realQuestions[idx].a.forEach(ans => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left bg-white/5 hover:bg-purple-500/20 hover:border-purple-500/50 text-slate-200 p-4 rounded-xl border border-white/10 active:scale-[0.98] transition duration-200";
                btn.innerText = ans;
                btn.onclick = () => runQuiz(idx + 1);
                aBox.appendChild(btn);
            });
        }
        
        runQuiz(0);

    </script>
</body>
</html>
