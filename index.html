<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N√∫cleo Insight | Diagn√≥stico Comportamental</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .blur-secret { filter: blur(8px); user-select: none; pointer-events: none; }
        .fade-in { animation: fadeIn 0.6s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .modal-open { display: flex !important; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 bg-gradient-to-b from-slate-900 to-slate-950">

    <div id="quiz-container" class="w-full max-w-md bg-slate-800/80 backdrop-blur-sm p-6 rounded-2xl shadow-2xl border border-slate-700 fade-in">
        <div class="mb-6 flex items-center justify-between">
            <span class="text-xs font-mono text-emerald-400">AN√ÅLISE EM TEMPO REAL</span>
            <div class="h-1.5 w-24 bg-slate-700 rounded-full overflow-hidden">
                <div id="progress-bar" class="h-full bg-emerald-500 transition-all duration-500" style="width: 5%"></div>
            </div>
        </div>
        <h2 id="question-text" class="text-xl md:text-2xl font-semibold mb-8 text-white leading-tight min-h-[80px]">...</h2>
        <div id="answers-box" class="space-y-3"></div>
    </div>

    <div id="processing-container" class="hidden w-full max-w-md text-center fade-in">
        <div class="relative w-20 h-20 mx-auto mb-6">
            <div class="absolute inset-0 rounded-full border-4 border-slate-700"></div>
            <div class="absolute inset-0 rounded-full border-4 border-emerald-500 border-t-transparent animate-spin"></div>
            <div class="absolute inset-0 flex items-center justify-center font-bold text-emerald-400 text-sm" id="process-pct">0%</div>
        </div>
        <h3 class="text-xl font-bold text-white mb-2">Processando Padr√µes...</h3>
        <p id="process-text" class="text-sm text-slate-400">Cruzando dados comportamentais...</p>
    </div>

    <div id="auth-container" class="hidden w-full max-w-md bg-slate-800 p-8 rounded-2xl shadow-2xl border border-slate-700 text-center fade-in">
        <div class="w-16 h-16 bg-amber-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
            <svg class="w-8 h-8 text-amber-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>
        </div>
        <h2 class="text-2xl font-bold text-white mb-2">Padr√£o de Risco Identificado</h2>
        <p class="text-slate-300 mb-8 text-sm leading-relaxed">Detectamos um ciclo de **Autossabotagem Inconsciente**. Para proteger a privacidade do diagn√≥stico, o acesso √© restrito.</p>
        <button onclick="loginGoogle()" class="w-full bg-white hover:bg-slate-100 text-slate-900 font-bold py-4 px-6 rounded-xl transition transform hover:scale-[1.02] flex items-center justify-center gap-3 shadow-lg">
            <img src="https://www.svgrepo.com/show/475656/google-color.svg" class="w-5 h-5" alt="G">
            Liberar Meu Resultado Agora
        </button>
        <p class="text-xs text-slate-500 mt-4">Ambiente Seguro e Criptografado</p>
    </div>

    <div id="dashboard-container" class="hidden w-full max-w-md fade-in pb-20">
        <div class="flex items-center justify-between mb-6 px-2">
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 bg-emerald-500 rounded-full animate-pulse"></div>
                <span class="text-xs font-mono text-emerald-400">SISTEMA ONLINE</span>
            </div>
            <button onclick="logout()" class="text-xs text-slate-500 hover:text-white underline">Sair</button>
        </div>

        <div class="bg-slate-800 rounded-2xl overflow-hidden border border-slate-700 shadow-2xl relative mb-6">
            <div class="bg-slate-900/50 p-4 border-b border-slate-700 flex justify-between items-center">
                <h3 class="font-bold text-white">Diagn√≥stico Final</h3>
                <span class="bg-red-500/20 text-red-400 text-xs px-2 py-1 rounded font-mono">CR√çTICO</span>
            </div>
            
            <div class="p-6 relative">
                <h2 class="text-2xl font-bold text-white mb-4">Arqu√©tipo: <span class="text-emerald-400">Disponibilidade Assim√©trica</span></h2>
                
                <div id="premium-content" class="text-slate-300 space-y-4 blur-secret transition-all duration-700 text-sm leading-relaxed">
                    <p><strong class="text-white">A Verdade Brutal:</strong> Voc√™ ensinou a ele que o seu tempo n√£o vale nada.</p>
                    <p>Nossos dados mostram que em 90% das suas intera√ß√µes, voc√™ respondeu em menos de 5 minutos, enquanto ele demorava horas. Isso criou um desequil√≠brio qu√≠mico no c√©rebro dele: <span class="text-emerald-300">falta de dopamina por esfor√ßo.</span></p>
                    <p>Ele n√£o se afastou porque parou de gostar. Ele se afastou porque a conquista acabou r√°pido demais. Homens com o perfil dele precisam sentir que est√£o "ganhando" sua aten√ß√£o aos poucos.</p>
                    
                    <div class="bg-slate-900/50 p-4 rounded-lg border-l-2 border-amber-500 my-4">
                        <p class="text-amber-400 font-bold text-xs mb-1">PREVIS√ÉO DO SISTEMA:</p>
                        <p class="italic text-slate-400">"Se voc√™ mandar mais uma mensagem cobrando aten√ß√£o hoje, as chances de bloqueio definitivo sobem para 94%."</p>
                    </div>

                    <p><strong class="text-white">O Plano de Resgate:</strong></p>
                    <ul class="list-disc pl-4 space-y-2 text-slate-400">
                        <li>Interromper inicia√ß√£o de conversa por 72h.</li>
                        <li>Usar a t√©cnica do "Espelho Atrasado" (explicada no simulador).</li>
                        <li>Postar "Gatilhos de Curiosidade" nos stories (sem indiretas).</li>
                    </ul>
                </div>

                <div id="paywall-overlay" class="absolute inset-0 bg-slate-900/90 backdrop-blur-[2px] flex flex-col items-center justify-center p-6 text-center z-10">
                    <div class="w-12 h-12 bg-slate-800 rounded-full flex items-center justify-center mb-4 border border-slate-600">
                        <svg class="w-6 h-6 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2">Relat√≥rio Bloqueado</h3>
                    <p class="text-sm text-slate-300 mb-6">Voc√™ est√° a um passo de cometer um erro irrevers√≠vel. Destrave o diagn√≥stico e o Simulador agora.</p>
                    
                    <a href="https://pay.kiwify.com.br/cAMh7az" target="_blank" class="w-full bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-400 hover:to-emerald-500 text-white font-bold py-4 px-4 rounded-xl transition shadow-lg shadow-emerald-500/25 mb-3 flex items-center justify-center gap-2 group">
                        <span>Desbloquear Tudo</span>
                        <span class="bg-emerald-800 text-emerald-100 text-xs px-2 py-0.5 rounded">R$ 27,00</span>
                    </a>

                    <button id="admin-btn" onclick="simularCompraDev()" class="hidden mt-6 text-[10px] text-slate-700 uppercase hover:text-white border border-slate-800 px-2 py-1 rounded">
                        [ADMIN MODE: Simular Pagamento]
                    </button>
                </div>
            </div>
        </div>
        
        <div id="simulator-card" class="bg-slate-800 p-1 rounded-xl border border-slate-700 opacity-50 pointer-events-none transition-all duration-500">
            <button onclick="openSimulator()" class="w-full bg-slate-800 hover:bg-slate-750 p-4 rounded-lg flex items-center justify-between group">
                <div class="text-left">
                    <h4 class="font-bold text-white text-sm flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-emerald-500 animate-pulse"></span>
                        Simulador de Mensagens
                    </h4>
                    <p class="text-xs text-slate-400 mt-1">Gere a resposta perfeita para cada situa√ß√£o.</p>
                </div>
                <div id="lock-icon">
                    <svg class="w-5 h-5 text-slate-500 group-hover:text-emerald-400 transition" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/></svg>
                </div>
            </button>
        </div>
    </div>

    <div id="simulator-modal" class="hidden fixed inset-0 z-50 bg-slate-900/95 backdrop-blur-sm items-center justify-center p-4">
        <div class="bg-slate-800 w-full max-w-md rounded-2xl border border-slate-700 shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <div class="p-4 border-b border-slate-700 flex justify-between items-center bg-slate-900">
                <h3 class="font-bold text-white">Simulador Neural 2.0</h3>
                <button onclick="closeSimulator()" class="text-slate-400 hover:text-white">‚úï</button>
            </div>
            <div class="p-4 overflow-y-auto space-y-4">
                <p class="text-xs text-slate-400 uppercase font-bold">Escolha o cen√°rio atual:</p>
                <div class="space-y-3">
                    <button onclick="showScript('ghosting')" class="w-full text-left bg-slate-700 p-4 rounded-lg hover:bg-slate-600 transition border border-slate-600">
                        <span class="block text-white font-bold text-sm">üëª Ele sumiu (Ghosting)</span>
                        <span class="text-xs text-slate-400">N√£o responde h√° mais de 24h</span>
                    </button>
                    <button onclick="showScript('cold')" class="w-full text-left bg-slate-700 p-4 rounded-lg hover:bg-slate-600 transition border border-slate-600">
                        <span class="block text-white font-bold text-sm">‚ùÑÔ∏è Ele est√° frio/seco</span>
                        <span class="text-xs text-slate-400">Responde monos√≠labos</span>
                    </button>
                    <button onclick="showScript('invite')" class="w-full text-left bg-slate-700 p-4 rounded-lg hover:bg-slate-600 transition border border-slate-600">
                        <span class="block text-white font-bold text-sm">üìÖ Cancelou em cima da hora</span>
                        <span class="text-xs text-slate-400">Deu uma desculpa esfarrapada</span>
                    </button>
                </div>
                <div id="script-result" class="hidden mt-6 bg-emerald-900/20 border border-emerald-500/30 p-4 rounded-lg">
                    <p class="text-xs text-emerald-400 mb-2 font-bold uppercase">Copie e envie agora:</p>
                    <p id="script-text" class="text-white text-sm font-medium bg-slate-900 p-3 rounded select-all">...</p>
                    <p class="text-[10px] text-slate-500 mt-2 text-center">N√£o adicione emojis. Mande e saia do WhatsApp.</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCFnz5Wis_b3CGGblNn-bfUjqEgTOlqGNE",
            authDomain: "nucleoinsight-e4566.firebaseapp.com",
            projectId: "nucleoinsight-e4566",
            storageBucket: "nucleoinsight-e4566.firebasestorage.app",
            messagingSenderId: "650150743348",
            appId: "1:650150743348:web:f62f3cc95a38a5e90ca961",
            measurementId: "G-M24P3TBP5J"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // üö® LISTA VIP: Somente estes emails veem o bot√£o de teste
        const adminEmails = [
            "contatogilvannborges@gmail.com",
            "gilvanxavierborges@gmail.com"
        ];

        const questions = [
            { t: "Quando voc√™ envia uma mensagem e ele demora, qual seu primeiro pensamento?", a: ["'Ele perdeu o interesse.'", "'Talvez esteja ocupado.'", "'Vou apagar antes que ele leia.'", "'Melhor mandar outra pra garantir.'"] },
            { t: "Nos √∫ltimos 3 meses, quem iniciou a maioria das conversas?", a: ["Eu (quase sempre)", "Ele (quase sempre)", "Equilibrado", "Ele inicia, mas some depois"] },
            { t: "Se ele postar um story agora, quanto tempo voc√™ leva para ver?", a: ["Imediatamente (tenho notifica√ß√£o)", "Em alguns minutos", "S√≥ quando abro o app", "Evito ver pra n√£o dar moral"] },
            { t: "Voc√™ sente que precisa 'pisar em ovos' para n√£o irrit√°-lo?", a: ["Sim, tenho medo de falar errado", "√Äs vezes", "N√£o, sou espont√¢nea", "Sinto que ele que pisa em ovos"] },
            { t: "Como foi o fim (ou afastamento) da √∫ltima vez?", a: ["Do nada (Ghosting)", "Briga explosiva", "Esfriou aos poucos", "Ainda estamos nos falando, mas mal"] },
            { t: "O quanto voc√™ sabe da rotina dele?", a: ["Sei tudo (stalkei/pergunto)", "Sei o b√°sico", "Sei s√≥ o que ele conta", "N√£o sei quase nada"] },
            { t: "Quando voc√™s saem, a qu√≠mica √©...", a: ["Incr√≠vel, parece alma g√™mea", "Boa, mas ele √© fechado", "Normal", "Sinto ele distante pessoalmente"] },
            { t: "Voc√™ j√° deixou de fazer algo seu para ficar dispon√≠vel pra ele?", a: ["V√°rias vezes", "Raramente", "Nunca", "Sim, cancelei compromissos"] },
            { t: "Ele j√° disse que voc√™ √© 'intensa demais' ou 'dram√°tica'?", a: ["Sim, j√° ouvi isso", "Disse que sou fechada", "Nunca disse", "Disse que sou a mulher da vida dele"] },
            { t: "O que voc√™ MAIS quer agora?", a: ["Entender por que ele mudou", "Fazer ele correr atr√°s", "Ter paz de esp√≠rito", "Uma resposta definitiva"] }
        ];

        let currentQ = 0;
        
        window.openSimulator = () => document.getElementById('simulator-modal').classList.add('modal-open');
        window.closeSimulator = () => document.getElementById('simulator-modal').classList.remove('modal-open');
        
        window.showScript = (type) => {
            const box = document.getElementById('script-result');
            const text = document.getElementById('script-text');
            box.classList.remove('hidden');
            if(type === 'ghosting') text.innerText = "Vi algo hoje que me lembrou muito voc√™. Espero que esteja tudo bem por a√≠.";
            if(type === 'cold') text.innerText = "Parece que voc√™ est√° num dia corrido. A gente se fala quando estiver mais tranquilo.";
            if(type === 'invite') text.innerText = "Tranquilo. Aproveite seu dia.";
        };

        const quizContainer = document.getElementById('quiz-container');
        const processingContainer = document.getElementById('processing-container');
        const authContainer = document.getElementById('auth-container');
        const dashboardContainer = document.getElementById('dashboard-container');

        function showQuestion() {
            const q = questions[currentQ];
            document.getElementById('question-text').innerText = q.t;
            const box = document.getElementById('answers-box');
            box.innerHTML = '';
            const pct = ((currentQ) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${pct}%`;
            q.a.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left bg-slate-700/50 hover:bg-emerald-900/30 hover:border-emerald-500/50 text-slate-200 p-4 rounded-xl transition border border-slate-600 active:scale-[0.98]";
                btn.innerText = opt;
                btn.onclick = () => nextQuestion();
                box.appendChild(btn);
            });
        }

        function nextQuestion() {
            currentQ++;
            if (currentQ < questions.length) { showQuestion(); } else { startProcessing(); }
        }

        function startProcessing() {
            quizContainer.classList.add('hidden');
            processingContainer.classList.remove('hidden');
            let pct = 0;
            const interval = setInterval(() => {
                pct += Math.floor(Math.random() * 15);
                if(pct > 100) pct = 100;
                document.getElementById('process-pct').innerText = pct + '%';
                if(pct === 100) {
                    clearInterval(interval);
                    setTimeout(() => {
                        processingContainer.classList.add('hidden');
                        authContainer.classList.remove('hidden');
                    }, 800);
                }
            }, 300);
        }

        window.loginGoogle = async () => {
            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                await setDoc(doc(db, "users", user.email), {
                    email: user.email,
                    status: "free",
                    lastLogin: new Date()
                }, { merge: true });
            } catch (error) { console.error(error); }
        };

        window.logout = () => { signOut(auth).then(() => window.location.reload()); };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                quizContainer.classList.add('hidden');
                processingContainer.classList.add('hidden');
                authContainer.classList.add('hidden');
                dashboardContainer.classList.remove('hidden');

                // üîì CHECAGEM VIP: Se for Admin, mostra o bot√£o
                if(adminEmails.includes(user.email)) {
                    document.getElementById('admin-btn').classList.remove('hidden');
                }

                onSnapshot(doc(db, "users", user.email), (doc) => {
                    const data = doc.data();
                    if (data && data.status === "premium") {
                        document.getElementById('premium-content').classList.remove('blur-secret');
                        document.getElementById('paywall-overlay').classList.add('hidden');
                        
                        const simCard = document.getElementById('simulator-card');
                        simCard.classList.remove('opacity-50', 'pointer-events-none');
                        simCard.classList.add('border-emerald-500', 'shadow-lg', 'shadow-emerald-900/50');
                        document.getElementById('lock-icon').innerHTML = '‚úÖ';
                    }
                });
            }
        });
        
        // Fun√ß√£o de Admin
        window.simularCompraDev = async () => {
            const user = auth.currentUser;
            if(user) await setDoc(doc(db, "users", user.email), { status: "premium" }, { merge: true });
        };

        showQuestion();
    </script>
</body>
</html>
