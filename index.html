<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Núcleo Insight | Análise Comportamental</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .blur-secret { filter: blur(6px); user-select: none; pointer-events: none; }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <div id="quiz-container" class="w-full max-w-md bg-slate-800 p-6 rounded-xl shadow-2xl fade-in">
        <div class="mb-4">
            <div class="h-2 bg-slate-700 rounded-full">
                <div id="progress-bar" class="h-2 bg-emerald-500 rounded-full transition-all duration-300" style="width: 10%"></div>
            </div>
            <p class="text-xs text-slate-400 mt-2 text-right">Análise em andamento...</p>
        </div>
        
        <h2 id="question-text" class="text-xl font-semibold mb-6 text-white">Carregando...</h2>
        
        <div id="answers-box" class="space-y-3">
            </div>
    </div>

    <div id="auth-container" class="hidden w-full max-w-md bg-slate-800 p-8 rounded-xl shadow-2xl text-center fade-in">
        <div class="mb-6">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-500 mx-auto mb-4"></div>
            <h2 class="text-2xl font-bold text-white">Análise Concluída</h2>
            <p class="text-slate-400 mt-2">Identificamos um padrão de alto impacto nas suas interações.</p>
        </div>
        <p class="text-sm text-slate-300 mb-6">Para gerar seu relatório seguro e evitar perda de dados, conecte-se:</p>
        <button onclick="loginGoogle()" class="w-full bg-white text-slate-900 font-bold py-3 px-4 rounded-lg hover:bg-slate-100 transition flex items-center justify-center gap-2">
            <svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="currentColor" d="M21.35 11.1h-9.17v2.73h6.51c-.33 3.81-3.5 5.44-6.5 5.44C8.36 19.27 5 16.25 5 12c0-4.1 3.2-7.27 7.2-7.27c3.09 0 4.9 1.97 4.9 1.97L19 4.72S16.56 2 12.1 2C6.42 2 2.03 6.8 2.03 12c0 5.05 4.13 10 10.22 10c5.35 0 9.25-3.67 9.25-9.09c0-1.15-.15-2.15-.15-2.15z"/></svg>
            Ver Meu Resultado
        </button>
    </div>

    <div id="dashboard-container" class="hidden w-full max-w-md fade-in">
        <div class="flex items-center justify-between mb-6">
            <span class="text-xs font-mono text-emerald-400 bg-emerald-900/30 px-2 py-1 rounded">NÚCLEO INSIGHT /// ID: <span id="user-id-display">...</span></span>
            <button onclick="logout()" class="text-xs text-slate-500 hover:text-white">Sair</button>
        </div>

        <div class="bg-slate-800 rounded-xl p-6 mb-4 relative overflow-hidden border border-slate-700">
            <h3 class="text-lg font-bold text-white mb-2">Seu Padrão: <span class="text-emerald-400">Disponibilidade Assimétrica</span></h3>
            
            <div id="premium-content" class="text-slate-300 text-sm space-y-4 blur-secret transition-all duration-500">
                <p>Você entrega 80% do esforço emocional no início da interação. Isso cria um "vácuo de interesse" no parceiro.</p>
                <p><strong>A Solução:</strong> Identificamos 3 gatilhos que você precisa ativar hoje.</p>
                <div class="bg-slate-900 p-4 rounded border border-slate-600">
                    <p class="text-emerald-400 font-bold mb-1">Ferramenta: Simulador de Mensagens</p>
                    <p>Use nosso script 'Espelho' para reverter o ghosting em 24h.</p>
                </div>
            </div>

            <div id="paywall-overlay" class="absolute inset-0 bg-slate-900/80 flex flex-col items-center justify-center p-6 text-center z-10">
                <svg class="w-12 h-12 text-red-500 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                <h3 class="text-xl font-bold text-white mb-1">Diagnóstico Bloqueado</h3>
                <p class="text-sm text-slate-300 mb-4">Seu padrão é de Alto Risco. Libere o acesso completo e o Simulador.</p>
                <a href="SEU_LINK_KIWIFY_AQUI" target="_blank" class="w-full bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-3 px-4 rounded-lg transition shadow-lg shadow-emerald-500/20 mb-2">
                    Desbloquear por R$ 27,00
                </a>
                <p class="text-xs text-slate-500 mt-2">Acesso imediato após pagamento.</p>
                
                <button onclick="simularCompraDev()" class="mt-8 text-[10px] text-slate-700 hover:text-white uppercase tracking-widest">
                    [Dev: Simular Pagamento]
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        // Importando Firebase direto do Google (Sem instalação)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // SUA CONFIGURAÇÃO (Já inserida)
        const firebaseConfig = {
            apiKey: "AIzaSyCFnz5Wis_b3CGGblNn-bfUjqEgTOlqGNE",
            authDomain: "nucleoinsight-e4566.firebaseapp.com",
            projectId: "nucleoinsight-e4566",
            storageBucket: "nucleoinsight-e4566.firebasestorage.app",
            messagingSenderId: "650150743348",
            appId: "1:650150743348:web:f62f3cc95a38a5e90ca961",
            measurementId: "G-M24P3TBP5J"
        };

        // Iniciar App
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // --- DADOS DO QUIZ ---
        const questions = [
            { t: "Quando ele demora a responder, o que você sente?", a: ["Raiva imediata", "Ansiedade/Medo", "Indiferença", "Culpa"] },
            { t: "Você costuma stalkear as redes sociais dele?", a: ["Todo dia", "Às vezes", "Nunca", "Só se sumir"] },
            { t: "Quem costuma puxar assunto primeiro?", a: ["Sempre eu", "Sempre ele", "Meio a meio", "Ninguém"] },
            { t: "Como você define sua última relação?", a: ["Intensa e curta", "Longa e morna", "Confusa", "Segura"] }
            // Adicionei 4 para teste rápido. Depois colocamos as 10.
        ];

        let currentQ = 0;
        let userAnswers = [];

        // --- LÓGICA DE INTERFACE ---
        const quizContainer = document.getElementById('quiz-container');
        const authContainer = document.getElementById('auth-container');
        const dashboardContainer = document.getElementById('dashboard-container');

        // Renderizar Pergunta
        function showQuestion() {
            const q = questions[currentQ];
            document.getElementById('question-text').innerText = q.t;
            const box = document.getElementById('answers-box');
            box.innerHTML = '';
            
            // Barra de progresso
            const pct = ((currentQ + 1) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${pct}%`;

            q.a.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left bg-slate-700 hover:bg-slate-600 text-slate-200 p-4 rounded-lg transition border border-slate-600";
                btn.innerText = opt;
                btn.onclick = () => nextQuestion(opt);
                box.appendChild(btn);
            });
        }

        function nextQuestion(answer) {
            userAnswers.push(answer);
            currentQ++;
            if (currentQ < questions.length) {
                showQuestion();
            } else {
                finishQuiz();
            }
        }

        function finishQuiz() {
            quizContainer.classList.add('hidden');
            authContainer.classList.remove('hidden');
        }

        // Expor funções para o HTML
        window.loginGoogle = async () => {
            try {
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                // Salvar respostas no banco
                await setDoc(doc(db, "users", user.uid), {
                    email: user.email,
                    answers: userAnswers,
                    status: "free", // Começa como grátis
                    createdAt: new Date()
                }, { merge: true }); // merge evita apagar se já existir
            } catch (error) {
                console.error(error);
                alert("Erro ao entrar. Tente novamente.");
            }
        };

        window.logout = () => signOut(auth);

        // --- MÁGICA EM TEMPO REAL ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // Usuário logado
                quizContainer.classList.add('hidden');
                authContainer.classList.add('hidden');
                dashboardContainer.classList.remove('hidden');
                document.getElementById('user-id-display').innerText = user.uid.slice(0,5);

                // Ouvir mudanças no pagamento em Tempo Real
                onSnapshot(doc(db, "users", user.uid), (doc) => {
                    const data = doc.data();
                    if (data && data.status === "premium") {
                        // DESBLOQUEAR TUDO
                        document.getElementById('premium-content').classList.remove('blur-secret');
                        document.getElementById('paywall-overlay').classList.add('hidden');
                    }
                });

            } else {
                // Ninguém logado (reseta se estava no dashboard)
                if(!authContainer.classList.contains('hidden') || !dashboardContainer.classList.contains('hidden')){
                    window.location.reload(); 
                }
            }
        });

        // SIMULAÇÃO DE PAGAMENTO (Para você testar)
        window.simularCompraDev = async () => {
            const user = auth.currentUser;
            if(user) {
                await setDoc(doc(db, "users", user.uid), { status: "premium" }, { merge: true });
                alert("Pagamento Simulado! O sistema deve desbloquear sozinho agora.");
            }
        };

        // Iniciar
        showQuestion();
    </script>
</body>
</html>
@NucleoInsight
Comment
