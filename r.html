<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecionando...</title>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCFnz5Wis_b3CGGblNn-bfUjqEgTOlqGNE",
            authDomain: "nucleoinsight-e4566.firebaseapp.com",
            projectId: "nucleoinsight-e4566",
            storageBucket: "nucleoinsight-e4566.firebasestorage.app",
            messagingSenderId: "650150743348",
            appId: "1:650150743348:web:f62f3cc95a38a5e90ca961",
            measurementId: "G-M24P3TBP5J"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function redirect() {
            const params = new URLSearchParams(window.location.search);
            const linkId = params.get('id');

            if (!linkId) {
                document.body.innerHTML = "<p style='text-align:center; margin-top:50px; color:white; font-family:sans-serif;'>Link inválido.</p>";
                return;
            }

            try {
                const docRef = doc(db, "short_links", linkId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    // Conta o clique no banco
                    updateDoc(docRef, { clicks: increment(1) });
                    // Redireciona
                    window.location.href = docSnap.data().target;
                } else {
                    document.body.innerHTML = "<p style='text-align:center; margin-top:50px; color:white; font-family:sans-serif;'>Link não encontrado no sistema.</p>";
                }
            } catch (error) {
                console.error("Erro:", error);
                document.body.innerHTML = "<p style='text-align:center; margin-top:50px; color:white; font-family:sans-serif;'>Erro ao buscar link.</p>";
            }
        }
        redirect();
    </script>
    <style>body{background-color:#0b0c15; color:white}</style>
</head>
<body>
    <p style="text-align:center; margin-top:50px; font-family:sans-serif; opacity:0.7;">Aguarde...</p>
</body>
</html>
